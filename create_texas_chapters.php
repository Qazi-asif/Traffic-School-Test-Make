<?php\n// Create Texas Course Chapters\n// This script creates chapters for Texas courses by copying from Florida course\n\nrequire_once 'vendor/autoload.php';\n\n$app = require_once 'bootstrap/app.php';\n$app->make('Illuminate\\Contracts\\Console\\Kernel')->bootstrap();\n\nuse Illuminate\\Support\\Facades\\DB;\nuse Carbon\\Carbon;\n\necho \"=== CREATING TEXAS COURSE CHAPTERS ===\\n\\n\";\n\n// Check if Texas courses exist\n$texasCourses = DB::table('florida_courses')\n    ->where('state_code', 'TX')\n    ->get();\n\necho \"Found \" . $texasCourses->count() . \" Texas courses:\\n\";\nforeach ($texasCourses as $course) {\n    echo \"- Course {$course->id}: {$course->title}\\n\";\n}\n\n// Get Florida course chapters to copy\n$floridaChapters = DB::table('chapters')\n    ->where('course_id', 1)\n    ->orderBy('order_index')\n    ->get();\n\necho \"\\nFound \" . $floridaChapters->count() . \" Florida chapters to copy\\n\";\n\n// Create chapters for each Texas course\nforeach ($texasCourses as $texasCourse) {\n    echo \"\\nCreating chapters for: {$texasCourse->title}\\n\";\n    \n    // Check if chapters already exist\n    $existingChapters = DB::table('chapters')\n        ->where('course_id', $texasCourse->id)\n        ->where('course_table', 'florida_courses')\n        ->count();\n    \n    if ($existingChapters > 0) {\n        echo \"  âš ï¸  {$existingChapters} chapters already exist, skipping...\\n\";\n        continue;\n    }\n    \n    $chapterCount = 0;\n    foreach ($floridaChapters as $floridaChapter) {\n        // Adapt content for Texas\n        $texasContent = str_replace(\n            ['Florida', 'FL', 'florida', 'Basic Driver Improvement', 'BDI'],\n            ['Texas', 'TX', 'texas', 'Defensive Driving', 'DD'],\n            $floridaChapter->content\n        );\n        \n        // Fix file:// image references while copying\n        $placeholderDiv = '<div style=\"max-width: 300px; height: 150px; border: 2px dashed #dee2e6; border-radius: 8px; padding: 20px; background: #f8f9fa; display: inline-block; text-align: center; margin: 10px;\"><div style=\"color: #6783a6; font-size: 16px; margin-bottom: 5px;\">ðŸ“· Image</div><div style=\"color: #99a3b4; font-size: 12px;\">Not Available</div></div>';\n        \n        // Replace file:// images with placeholders\n        $texasContent = preg_replace(\n            '/<!--\\s*\\[if gte vml 1\\]>.*?<v:shape[^>]*>.*?<v:imagedata[^>]*src=\"file:\\/\\/\\/[^\"]*\"[^>]*>.*?<\\/v:shape>.*?<!\\[endif\\]-->/s',\n            $placeholderDiv,\n            $texasContent\n        );\n        \n        $texasContent = preg_replace(\n            '/<img[^>]*src=\"file:\\/\\/\\/[^\"]*\"[^>]*>/i',\n            $placeholderDiv,\n            $texasContent\n        );\n        \n        $texasContent = preg_replace(\n            '/<v:imagedata[^>]*src=\"file:\\/\\/\\/[^\"]*\"[^>]*>/i',\n            '',\n            $texasContent\n        );\n        \n        // Create Texas chapter\n        DB::table('chapters')->insert([\n            'course_id' => $texasCourse->id,\n            'course_table' => 'florida_courses',\n            'title' => str_replace(['Florida', 'BDI'], ['Texas', 'Defensive Driving'], $floridaChapter->title),\n            'content' => $texasContent,\n            'video_url' => $floridaChapter->video_url,\n            'order_index' => $floridaChapter->order_index,\n            'duration' => $floridaChapter->duration,\n            'is_active' => true,\n            'created_at' => Carbon::now(),\n            'updated_at' => Carbon::now(),\n        ]);\n        \n        $chapterCount++;\n    }\n    \n    echo \"  âœ… Created {$chapterCount} chapters for course {$texasCourse->id}\\n\";\n}\n\necho \"\\n=== TEXAS CHAPTERS CREATION COMPLETE ===\\n\";\necho \"\\nNext steps:\\n\";\necho \"1. Test the Texas course in browser\\n\";\necho \"2. Verify images show as placeholders\\n\";\necho \"3. Check that chapters load properly\\n\";\necho \"4. Test quizzes and final exam\\n\";\necho \"\\nTexas courses should now have full content!\\n\";\n?>"